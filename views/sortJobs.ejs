<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Get Print jobs</title>
    <link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>
    <p>Please click on a button to view the print jobs in the specified order.</p>
    <div id="sortButtons">
        <button type="button" onclick="getPrintJobs('first')">Sort By First Name</button>
        <button type="button" onclick="getPrintJobs('last')">Sort By Last Name</button>
        <button type="button" onclick="getPrintJobs('print')">Sort By Print Name</button>
        <button type="button" onclick="getPrintJobs('status')">Sort By Print Status</button>
    </div>
    <br>
    <br>
    <table id="printTable">
        <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Print Name</th>
            <th>Print Source</th>
            <th>Print Use</th>
            <th>Print Color</th>
            <th>Type of Plastic</th>
            <th>Filename</th>
            <th>Google Drive URL</th>
            <th>Update Date</th>
            <th>Error Message (if needed)</th>
        </tr>
    </table>

    <script>
        function getPrintJobs(type) {
            var serverData;
            var url = "/sortPrintJobs?sortType=" + type;

            console.log("URL: " + url);

            var xhttp = new XMLHttpRequest();

            xhttp.onload = function () {
                if (this.readyState == 4 && this.status == 200) {
                    console.log("Got response from server: ")
                    console.log(this.reponse);

                    serverData = JSON.parse(this.responseText);

                    console.log(serverData);

                    renderPrintJobs(serverData);
                } else {
                    console.log("Server request failed")
                }
            };
            xhttp.open("get", url, true)
            xhttp.send();


        }

        function renderPrintJobs(data) {
            var myTable = document.getElementById("printTable");
            var numItems;

            for (var i = 0; i < data.length; i++) {
                // Get row values
                var first = data[i].firstname;
                var last = data[i].lastname;
                var printname = data[i].printname;
                var source = data[i].modelsource;
                var use = data[i].printuse;
                var color = data[i].color;
                var material = data[i].printmaterial;
                var filename = data[i].filename;
                var driveurl = data[i].driveurl;
                var status = data[i].jobstatus;
                var date = data[i].statusdate;
                if (typeof data[i].errormessage !== 'undefined') {
                    var error = data[i].errormessage;
                    numItems = 12;
                } else {
                    numItems = 11;
                }

                // Check values in console
                console.log("Firstname: " + first);
                console.log("Lastname: " + last);
                console.log("Print Name: " + printname);
                console.log("Source: " + source);
                console.log("Print Use: " + use);
                console.log("Color: " + color);
                console.log("Firstname: " + material);
                console.log("Filename: " + filename);
                console.log("Google Drive URL: " + driveurl);
                console.log("Job Status: " + status);
                console.log("Data: " + date);
                if (typeof data[i].errormessage !== 'undefined') {
                    console.log("Error Message: " + error);
                }

                // Create new row
                var row = myTable.insertRow();

                // Add cells into new row
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);
                var cell6 = row.insertCell(5);
                var cell7 = row.insertCell(6);
                var cell8 = row.insertCell(7);
                var cell9 = row.insertCell(8);
                var cell10 = row.insertCell(9);
                var cell11 = row.insertCell(10);
                var cell12 = row.insertCell(11);

                // Insert values into new cells
                cell1.innerHTML = first;
                cell2.innerHTML = last;
                cell3.innerHTML = source;
                cell4.innerHTML = printname;
                cell5.innerHTML = use;
                cell6.innerHTML = color;
                cell7.innerHTML = material;
                cell8.innerHTML = filename;
                cell9.innerHTML = driveurl;
                cell10.innerHTML = status;
                cell11.innerHTML = date;
                if (typeof data[i].errormessage !== 'undefined') {
                    cell12.innerHTML = errormessage;
                } else {
                    cell12.innerHTML = "";
                }
            }
        }
    </script>
</body>

</html>